<!doctype html>
<html>
  <head>
    <title>Datacharts</title>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>
  </head>
  <body>
    <a
      href="https://dataclips-next.heroku.com/<%= params[:dataclip] %>">Source</a>
    <canvas id="canvas" height="450" width="600"></canvas>

    <script>

      var xhr = $.get("https://dataclips.heroku.com/<%= params[:dataclip] %>.json");
      xhr.done(function(data) {
        var herokudata = data
        var labels = [];
        var data = [];

        for (i = 0; i < herokudata.values.length; i++) {
          var pairs = herokudata.values[i];
          labels[i] = pairs[0];
          data[i] = pairs[1];
        }

        doWork(labels, data);
      })

      function doWork (labels, data) {
        var randomScalingFactor = function(){ return Math.round(Math.random()*100)};
        var lineChartData = {
          labels : labels,
          datasets : [
            {
            label: "My First dataset",
            fillColor : "rgba(160, 140, 204, 0.3)",
            strokeColor : "#a18dcc",
            pointColor : "rgba(220,220,220,1)",
            pointStrokeColor : "#fff",
            pointHighlightFill : "#fff",
            pointHighlightStroke : "rgba(220,220,220,1)",
            data: data
          }
          ]
        }
        var ctx = document.getElementById("canvas").getContext("2d");
        window.myLine = new Chart(ctx).Line(lineChartData, {
          responsive: true
        });
      }
    </script>
  </body>
</html>
